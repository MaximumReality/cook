<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>The Spice | Snack Attack</title>
    <style>
        :root { --neon-cyan: #00FFFF; --neon-pink: #FF00FF; --neon-green: #39FF14; }
        
        body {
            margin: 0; padding: 0;
            background: url('cyber-kitchen-bg.PNG') no-repeat center center fixed;
            background-size: cover;
            height: 100vh; overflow: hidden; background-color: #000;
            font-family: 'Courier New', monospace;
        }

        body::before {
            content: ""; position: fixed; inset: 0;
            background: rgba(0, 0, 0, 0.6); z-index: 1;
        }

        #ui { 
            position: absolute; top: 85px; left: 20px; 
            color: var(--neon-cyan); z-index: 100; text-shadow: 2px 2px #000;
        }
        
        /* The Bowl - Anchored at 75% down the screen */
        #target-bowl {
            position: absolute;
            top: 75vh; left: 50%;
            transform: translate(-50%, -50%);
            width: 320px; 
            z-index: 50; /* Top layer */
        }

        /* The Garlic - High enough to see, but low enough for a quick drop */
        #garlic-claw {
            position: absolute;
            top: 200px; 
            width: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10; /* Behind the bowl when it falls */
            animation: moveHorizontal 2.5s ease-in-out infinite alternate;
        }

        @keyframes moveHorizontal {
            from { left: 15%; }
            to { left: 85%; }
        }

        /* Dropping Logic - Ends deep enough to hide behind the bowl */
        .dropping {
            animation: none !important;
            transition: top 0.5s ease-in, opacity 0.3s ease-in 0.2s;
            top: 75vh !important; 
            opacity: 0;
        }

        /* The Ripple - Oval shaped to fit the bowl surface */
        .ripple {
            position: absolute;
            top: 70vh; left: 50%;
            transform: translate(-50%, -50%);
            width: 20px; height: 10px;
            border: 3px solid var(--neon-cyan);
            border-radius: 50%;
            pointer-events: none;
            z-index: 40; /* Just under the bowl rim but above the soup */
            box-shadow: 0 0 15px var(--neon-cyan);
            animation: ripple-out 0.6s ease-out forwards;
        }

        @keyframes ripple-out {
            0% { width: 20px; height: 10px; opacity: 1; }
            100% { width: 250px; height: 100px; opacity: 0; }
        }

        #next-btn {
            display: none; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); padding: 20px 40px;
            background: var(--neon-green); border: none; color: black;
            font-weight: bold; border-radius: 50px; z-index: 500;
            box-shadow: 0 0 20px var(--neon-green);
        }
    </style>
</head>
<body onclick="dropGarlic()">

<div id="ui">MISSION: CALIBRATE FLAVOR<br>Garlic Claws: <span id="score">0</span>/3</div>

<img src="garlic.png" id="garlic-claw">
<img src="bowl-with-soup.png" id="target-bowl">

<button id="next-btn" onclick="window.location.href='stage4.html'">SERVE MEAL</button>

<script>
    // Audio Unlocker
    const music = new Audio('funny-arcade-game.mp3'); 
    music.loop = true;
    const startMusic = () => {
        music.play().catch(e => {});
        window.removeEventListener('touchstart', startMusic);
    };
    window.addEventListener('touchstart', startMusic);

    let caught = 0;
    const claw = document.getElementById('garlic-claw');
    const bowl = document.getElementById('target-bowl');
    const scoreText = document.getElementById('score');
    const nextBtn = document.getElementById('next-btn');

    function createRipple() {
        const ripple = document.createElement('div');
        ripple.className = 'ripple';
        document.body.appendChild(ripple);
        ripple.addEventListener('animationend', () => ripple.remove());
    }

    function dropGarlic() {
        if (claw.classList.contains('dropping')) return;

        // Sync position
        const currentLeft = window.getComputedStyle(claw).left;
        claw.style.left = currentLeft;
        claw.classList.add('dropping');
        
        const clawRect = claw.getBoundingClientRect();
        const bowlRect = bowl.getBoundingClientRect();

        setTimeout(() => {
            const finalLeft = clawRect.left + (clawRect.width / 2);
            
            // Detection: Check if garlic center is within bowl edges
            if (finalLeft > bowlRect.left && finalLeft < bowlRect.right) {
                caught++;
                scoreText.innerText = caught;
                createRipple(); 
                if (navigator.vibrate) navigator.vibrate([15, 10, 15]);
            }

            if (caught >= 3) {
                nextBtn.style.display = 'block';
                claw.style.display = 'none';
            } else {
                // Reset for next garlic
                claw.style.transition = "none";
                claw.classList.remove('dropping');
                claw.style.top = "200px"; // Back to start height
                claw.style.opacity = "1";
                void claw.offsetWidth; 
                claw.style.transition = ""; 
            }
        }, 500); 
    }
</script>
</body>
</html>
