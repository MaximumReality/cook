<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>The Spice | Maximum Reality</title>
    <style>
        :root { --neon-orange: #FFAC1C; --neon-pink: #FF00FF; --neon-cyan: #00FFFF; }
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Courier New', monospace; color: white; }
        
        #ui { position: absolute; top: 65px; width: 100%; text-align: center; z-index: 100; pointer-events: none; }
        .score-box { font-size: 24px; color: var(--neon-orange); text-shadow: 0 0 10px var(--neon-orange); }

        /* The Static Bowl from Stage 2 */
        #bowl-container {
            position: absolute; bottom: 100px; left: 50%;
            transform: translateX(-50%); width: 300px;
        }
        #bowl-img { width: 100%; height: auto; }

        /* Moving Spice Slider */
        #scanner-track {
            position: absolute; top: 200px; left: 10%; width: 80%;
            height: 4px; background: rgba(0, 255, 255, 0.2);
        }
        #spice-preview {
            position: absolute; top: -30px; left: 0;
            width: 60px; height: 60px; pointer-events: none;
        }

        /* Azul Feedback */
        #azul-verdict {
            position: absolute; top: 350px; width: 100%; text-align: center;
            font-size: 20px; color: var(--neon-cyan); display: none;
        }
        
        #next-btn {
            display: none; position: absolute; bottom: 40px; left: 50%;
            transform: translateX(-50%); padding: 20px 40px;
            background: var(--neon-pink); border: none; color: white;
            font-weight: bold; border-radius: 50px; z-index: 200;
        }
    </style>
</head>
<body onclick="dropGarnish()">

<div id="ui">
    <div class="score-box">FLAVOR LOCK: <span id="percent">0</span>%</div>
    <div style="font-size: 12px; color: var(--neon-cyan);">TAP TO ADD GARLIC CLAWS</div>
</div>

<div id="scanner-track">
    <img src="garlic.png" id="spice-preview">
</div>

<div id="azul-verdict">AZUL: CALIBRATING...</div>

<div id="bowl-container">
    <img src="bowl.png" id="bowl-img">
</div>

<button id="next-btn" onclick="window.location.href='stage4.html'">FINAL STAGE: SERVE</button>

<script>
    const spice = document.getElementById('spice-preview');
    const verdict = document.getElementById('azul-verdict');
    const percentEl = document.getElementById('percent');
    const nextBtn = document.getElementById('next-btn');
    
    let xPos = 0;
    let xDir = 3; // Speed of the moving garlic
    let active = true;
    let successfulDrops = 0;
    const targetDrops = 2; // Your "Two Claws" rule!

    function moveSlider() {
        if (!active) return;
        xPos += xDir;
        if (xPos > 90 || xPos < 0) xDir *= -1;
        spice.style.left = xPos + '%';
        requestAnimationFrame(moveSlider);
    }

    function dropGarnish() {
        if (!active) return;
        active = false;

        // The "Sweet Spot" is the middle of the track (aligned with the bowl)
        if (xPos > 38 && xPos < 52) {
            successfulDrops++;
            const progress = (successfulDrops / targetDrops) * 100;
            percentEl.innerText = progress;

            // Visual Drop
            spice.style.transition = 'top 0.4s ease-in, opacity 0.4s';
            spice.style.top = '400px';
            spice.style.opacity = '0';

            verdict.innerText = "AZUL: MOLECULAR PERFECTION";
            verdict.style.display = 'block';

            setTimeout(() => {
                if (successfulDrops >= targetDrops) {
                    nextBtn.style.display = 'block';
                } else {
                    resetGarnish();
                }
            }, 600);
        } else {
            verdict.innerText = "AZUL: CONCENTRATION FAILED - RETRY";
            verdict.style.color = "red";
            verdict.style.display = 'block';
            setTimeout(() => {
                verdict.style.display = 'none';
                active = true;
                moveSlider();
            }, 1000);
        }
    }

    function resetGarnish() {
        spice.style.transition = 'none';
        spice.style.top = '-30px';
        spice.style.opacity = '1';
        active = true;
        verdict.style.display = 'none';
        moveSlider();
    }

    moveSlider();
</script>
</body>
</html>
