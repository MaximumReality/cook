<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>The Spice | Snack Attack</title>
    <style>
        :root { --neon-cyan: #00FFFF; --neon-pink: #FF00FF; --neon-green: #39FF14; }
        
        body {
            margin: 0; padding: 0;
            background: url('cyber-kitchen-bg.PNG') no-repeat center center fixed;
            background-size: cover;
            height: 100vh; overflow: hidden; background-color: #000;
            font-family: 'Courier New', monospace;
        }

        body::before {
            content: ""; position: fixed; inset: 0;
            background: rgba(0, 0, 0, 0.6); z-index: 0;
        }

        #ui { 
            position: absolute; 
            top: 85px; /* Clear Dynamic Island */
            left: 20px; 
            color: var(--neon-cyan); 
            z-index: 100; 
            text-shadow: 2px 2px #000;
        }
        
        /* Updated CSS for Layering */
#target-bowl {
    position: absolute;
    top: 75vh; 
    left: 50%;
    transform: translate(-50%, -50%);
    width: 320px; 
    z-index: 30; /* Higher than the garlic */
}

#garlic-container {
    position: absolute;
    top: 150px;
    left: 0;
    width: 100%;
    height: 100px;
    z-index: 20; /* Lower than the bowl */
}




        #garlic-claw {
            position: absolute;
            width: 80px;
            left: 50%;
            transform: translateX(-50%);
            animation: moveHorizontal 2.5s ease-in-out infinite alternate;
        }

        @keyframes moveHorizontal {
            from { left: 15%; }
            to { left: 85%; }
        }

        /* Updated Drop Animation */

.dropping {
    animation: none !important; 
    transition: top 0.5s cubic-bezier(0.47, 0, 0.74, 0.71), 
                transform 0.5s, 
                opacity 0.2s ease-in 0.3s; /* Quicker fade-out at the end */
    
    top: 68vh !important; /* Matches your ripple height perfectly */
    
    transform: translateX(-50%) scale(0.5) !important;
    opacity: 0;
}


        .ripple {
    position: absolute;
    top: 68vh; 
    left: 50%;
    transform: translate(-50%, -50%);
    width: 20px;
    height: 10px;
    border: 3px solid var(--neon-cyan);
    border-radius: 50%;
    pointer-events: none;
    z-index: 25; /* Sits just behind the front rim but above the soup */
    box-shadow: 0 0 15px var(--neon-cyan);
    animation: ripple-out 0.6s ease-out forwards;
}

@keyframes ripple-out {
    0% { width: 20px; height: 10px; opacity: 1; border-width: 4px; }
    100% { width: 280px; height: 120px; opacity: 0; border-width: 1px; }
}

        #next-btn {
            display: none; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); padding: 20px 40px;
            background: var(--neon-green); border: none; color: black;
            font-weight: bold; border-radius: 50px; z-index: 500;
            box-shadow: 0 0 20px var(--neon-green);
        }
    </style>
</head>
<body onclick="dropGarlic()">

<div id="ui">MISSION: CALIBRATE FLAVOR<br>Garlic Claws: <span id="score">0</span>/3</div>

<div id="garlic-container">
    <img src="garlic.png" id="garlic-claw">
</div>

<img src="bowl-with-soup.png" id="target-bowl">

<button id="next-btn" onclick="window.location.href='win.html'">SERVE MEAL</button>

<script>
    /* MUSIC SETUP */
    const music = new Audio('funny-arcade-game.mp3'); 
    music.loop = true;
    music.preload = 'auto';

    const startMusic = () => {
        music.play().catch(e => console.log("Audio waiting..."));
        window.removeEventListener('touchstart', startMusic);
    };
    window.addEventListener('touchstart', startMusic);

    /* GAME VARIABLES */
    let caught = 0;
    const claw = document.getElementById('garlic-claw');
    const bowl = document.getElementById('target-bowl');
    const scoreText = document.getElementById('score');
    const nextBtn = document.getElementById('next-btn');

    /* RIPPLE GENERATOR - Moved outside for better performance */
    function createRipple() {
        const ripple = document.createElement('div');
        ripple.className = 'ripple';
        document.body.appendChild(ripple);
        ripple.addEventListener('animationend', () => ripple.remove());
    }

    /* DROP LOGIC */
    function dropGarlic() {
        if (claw.classList.contains('dropping')) return;

        // Capture horizontal position and trigger drop
        const currentLeft = window.getComputedStyle(claw).left;
        claw.style.left = currentLeft;
        claw.classList.add('dropping');
        
        const clawRect = claw.getBoundingClientRect();
        const bowlRect = bowl.getBoundingClientRect();

        setTimeout(() => {
            const finalLeft = clawRect.left + (clawRect.width / 2);
            
            // Hit Detection (Only happens once now!)
            if (finalLeft > bowlRect.left && finalLeft < bowlRect.right) {
                caught++;
                scoreText.innerText = caught;
                createRipple(); 
                if (navigator.vibrate) navigator.vibrate([15, 10, 15]);
            }

            if (caught >= 3) {
                nextBtn.style.display = 'block';
                claw.style.display = 'none';
            } else {
                // Instant Reset logic
                claw.style.transition = "none";
                claw.classList.remove('dropping');
                claw.style.top = "0px";
                claw.style.opacity = "1";
                void claw.offsetWidth; // Reflow
                claw.style.transition = ""; 
            }
        }, 600);
    }
</script>


</body>
</html>
