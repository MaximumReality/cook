<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>The Spice | Snack Attack</title>
    <style>
        :root { --neon-cyan: #00FFFF; --neon-pink: #FF00FF; --neon-green: #39FF14; --neon-red: #FF3131; }
        
        body {
            margin: 0; padding: 0;
            background: url('cyber-kitchen-bg.PNG') no-repeat center center fixed;
            background-size: cover;
            height: 100vh; overflow: hidden; background-color: #000;
            font-family: 'Courier New', monospace;
        }

        body::before {
            content: ""; position: fixed; inset: 0;
            background: rgba(0, 0, 0, 0.6); z-index: 1;
        }

        #ui { 
            position: absolute; top: 85px; left: 20px; 
            color: var(--neon-cyan); z-index: 100; text-shadow: 2px 2px #000;
        }
        
        #target-bowl {
            position: absolute;
            top: 75vh; left: 50%;
            transform: translate(-50%, -50%);
            width: 320px; 
            z-index: 50;
        }

        #garlic-claw {
            position: absolute;
            top: 180px; 
            width: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            /* Speed up the swing for more challenge */
            animation: moveHorizontal 1.8s ease-in-out infinite alternate;
        }

        @keyframes moveHorizontal {
            from { left: 20%; }
            to { left: 80%; }
        }

        .dropping {
            animation: none !important;
            transition: top 0.4s ease-in, opacity 0.2s ease-in 0.2s;
            top: 70vh !important; 
            opacity: 0;
        }

        /* The Ripple Overlay */
        .ripple {
            position: absolute;
            top: 70vh; left: 50%;
            transform: translate(-50%, -50%);
            width: 20px; height: 10px;
            border: 4px solid var(--neon-cyan);
            border-radius: 50%;
            pointer-events: none;
            z-index: 45;
            box-shadow: 0 0 20px var(--neon-cyan);
            animation: ripple-out 0.6s ease-out forwards;
        }

        @keyframes ripple-out {
            0% { width: 20px; height: 10px; opacity: 1; }
            100% { width: 280px; height: 110px; opacity: 0; }
        }

        /* MISS Indicator */
        .miss-text {
            position: absolute;
            top: 60vh; left: 50%;
            transform: translate(-50%, -50%);
            color: var(--neon-red);
            font-size: 3rem;
            font-weight: bold;
            text-shadow: 0 0 15px var(--neon-red);
            z-index: 200;
            animation: float-up 0.8s ease-out forwards;
        }

        @keyframes float-up {
            0% { transform: translate(-50%, 0); opacity: 1; }
            100% { transform: translate(-50%, -100px); opacity: 0; }
        }

        #next-btn {
            display: none; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); padding: 20px 40px;
            background: var(--neon-green); border: none; color: black;
            font-weight: bold; border-radius: 50px; z-index: 500;
            box-shadow: 0 0 20px var(--neon-green);
        }
    </style>
</head>
<body onclick="dropGarlic()">

<div id="ui">MISSION: CALIBRATE FLAVOR<br>Garlic Claws: <span id="score">0</span>/3</div>

<img src="garlic.png" id="garlic-claw">
<img src="bowl-with-soup.png" id="target-bowl">

<button id="next-btn" onclick="window.location.href='stage4.html'">SERVE MEAL</button>

<script>
    const music = new Audio('funny-arcade-game.mp3'); 
    music.loop = true;
    const startMusic = () => {
        music.play().catch(e => {});
        window.removeEventListener('touchstart', startMusic);
    };
    window.addEventListener('touchstart', startMusic);

    let caught = 0;
    const claw = document.getElementById('garlic-claw');
    const bowl = document.getElementById('target-bowl');
    const scoreText = document.getElementById('score');

    function createRipple() {
        const ripple = document.createElement('div');
        ripple.className = 'ripple';
        document.body.appendChild(ripple);
        ripple.addEventListener('animationend', () => ripple.remove());
    }

    function showMiss() {
        const miss = document.createElement('div');
        miss.className = 'miss-text';
        miss.innerText = 'MISS! ðŸª³';
        document.body.appendChild(miss);
        miss.addEventListener('animationend', () => miss.remove());
        if (navigator.vibrate) navigator.vibrate(200);
    }

    function dropGarlic() {
        if (claw.classList.contains('dropping')) return;

        const currentLeft = window.getComputedStyle(claw).left;
        claw.style.left = currentLeft;
        claw.classList.add('dropping');
        
        const clawRect = claw.getBoundingClientRect();
        const bowlRect = bowl.getBoundingClientRect();

        setTimeout(() => {
            const finalLeft = clawRect.left + (clawRect.width / 2);
            
            // TIGHTER CHECK: Reduced the tolerance so you have to hit the middle 50% of the bowl
            const bowlCenter = bowlRect.left + (bowlRect.width / 2);
            const tolerance = bowlRect.width * 0.25; // Narrower hit window

            if (finalLeft > bowlCenter - tolerance && finalLeft < bowlCenter + tolerance) {
                caught++;
                scoreText.innerText = caught;
                createRipple(); 
                if (navigator.vibrate) navigator.vibrate([15, 10, 15]);
            } else {
                // Penalty: Lose a point if you miss!
                caught = Math.max(0, caught - 1);
                scoreText.innerText = caught;
                showMiss();
            }

            if (caught >= 3) {
                claw.style.display = 'none';
                setTimeout(() => { window.location.href = 'stage4.html'; }, 1200);
            } else {
                setTimeout(() => {
                    claw.style.transition = "none";
                    claw.classList.remove('dropping');
                    claw.style.top = "180px"; 
                    claw.style.opacity = "1";
                    void claw.offsetWidth; 
                    claw.style.transition = ""; 
                }, 300);
            }
        }, 400); 
    }
</script>
</body>
</html>
