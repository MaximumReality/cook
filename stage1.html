<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Harira Harvest | Maximum Reality</title>
    <style>
        :root { --neon-green: #39FF14; --neon-cyan: #00FFFF; --neon-pink: #FF00FF; }
        body { margin: 0; background: #000; overflow: hidden; font-family: monospace; }
        
        #ui { 
            position: absolute; top: 65px; left: 20px; 
            color: var(--neon-cyan); font-size: 18px; z-index: 10; 
            text-shadow: 2px 2px #000;
        }
        .checklist { color: var(--neon-green); margin-top: 5px; }
        canvas { position: absolute; inset: 0; }
    </style>
</head>
<body>

<div id="ui">
    RECIPE: HARIRA BASE<br>
    <div id="check-list" class="checklist">
        - Chickpeas: 0/5<br>
        - Lentils: 0/5<br>
        - Garlic Claws: 0/2
    </div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Game State
let chefX = canvas.width / 2;
let items = [];
let gameActive = true;

const recipe = {
    chickpea: { count: 0, target: 5, color: '#f5deb3', label: 'Chickpeas' },
    lentil: { count: 0, target: 5, color: '#a52a2a', label: 'Lentils' },
    garlic: { count: 0, target: 2, color: '#ffffff', label: 'Garlic Claws' }
};

const ingredientTypes = ['chickpea', 'lentil', 'garlic'];

class Ingredient {
    constructor() {
        this.type = ingredientTypes[Math.floor(Math.random() * ingredientTypes.length)];
        this.x = Math.random() * (canvas.width - 40) + 20;
        this.y = -50;
        this.speed = 3 + Math.random() * 3;
    }
    update() {
        this.y += this.speed;
        // Collision with Chef (Bottom of screen)
        if (this.y > canvas.height - 150 && this.y < canvas.height - 100 &&
            this.x > chefX - 60 && this.x < chefX + 60) {
            
            recipe[this.type].count = Math.min(recipe[this.type].count + 1, recipe[this.type].target);
            updateUI();
            this.y = canvas.height + 100; // Remove item
            checkWin();
        }
    }
    draw() {
        ctx.fillStyle = recipe[this.type].color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, 15, 0, Math.PI * 2);
        ctx.fill();
        // Add a neon glow
        ctx.shadowBlur = 10;
        ctx.shadowColor = recipe[this.type].color;
    }
}

function updateUI() {
    const list = document.getElementById('check-list');
    list.innerHTML = `
        - Chickpeas: ${recipe.chickpea.count}/${recipe.chickpea.target}<br>
        - Lentils: ${recipe.lentil.count}/${recipe.lentil.target}<br>
        - Garlic Claws: ${recipe.garlic.count}/${recipe.garlic.target}
    `;
}

function checkWin() {
    if (recipe.chickpea.count >= recipe.chickpea.target &&
        recipe.lentil.count >= recipe.lentil.target &&
        recipe.garlic.count >= recipe.garlic.target) {
        gameActive = false;
        setTimeout(() => { window.location.href = 'stage2.html'; }, 500);
    }
}

// Input Handling
window.addEventListener('touchmove', e => {
    e.preventDefault();
    chefX = e.touches[0].clientX;
}, {passive: false});

function loop() {
    if (!gameActive) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (Math.random() < 0.03) items.push(new Ingredient());
    
    items.forEach((item, index) => {
        item.update();
        item.draw();
        if (item.y > canvas.height) items.splice(index, 1);
    });

    // Draw Chef Placeholder (Swap with mochkil_happy.png later)
    ctx.fillStyle = '#FF00FF';
    ctx.fillRect(chefX - 50, canvas.height - 130, 100, 20); 

    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
