<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>The Mash | Snack Attack</title>
    <style>
        :root { --neon-blue: #00FFEF; --neon-pink: #FF00FF; }
        body { margin: 0; background: #000; overflow: hidden; font-family: monospace; color: white; }
        
        #ui-top { position: absolute; top: 60px; width: 100%; text-align: center; z-index: 10; }
        .glitch-text { color: var(--neon-pink); text-shadow: 2px 2px #000; font-size: 1.2rem; }
        
        #pot-container {
            position: absolute; top: 55%; left: 50%;
            transform: translate(-50%, -50%);
            width: 300px; height: 300px;
        }
        
        /* The Ladle/Spoon that follows the touch */
        #ladle {
            position: absolute; width: 60px; height: 60px;
            background: var(--neon-blue); border-radius: 50%;
            pointer-events: none; opacity: 0.7; box-shadow: 0 0 20px var(--neon-blue);
        }

        #progress-ring {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 320px; height: 320px;
            border: 5px dashed #333; border-radius: 50%;
        }

        #next-btn {
            display: none; position: absolute; bottom: 100px; left: 50%;
            transform: translateX(-50%); padding: 20px 40px;
            background: var(--neon-pink); border: none; color: white;
            font-weight: bold; border-radius: 50px; z-index: 100;
        }
    </style>
</head>
<body>

<div id="ui-top">
    <div class="glitch-text">STAGE 2: THE MASH</div>
    <p>STIR THE BESSARA TO PERFECTION</p>
    <div id="stat-msg" style="color: var(--neon-blue);">READY...</div>
</div>

<div id="progress-ring"></div>
<div id="pot-container">
    <div style="width:100%; height:100%; border:8px solid #444; border-radius:50%; background:#4a3219;"></div>
    <div id="ladle"></div>
</div>

<button id="next-btn" onclick="window.location.href='stage3.html'">NEXT STAGE: THE SPICE</button>

<script>
    const ladle = document.getElementById('ladle');
    const statMsg = document.getElementById('stat-msg');
    const nextBtn = document.getElementById('next-btn');
    const ring = document.getElementById('progress-ring');
    
    let totalRotation = 0;
    let lastAngle = null;
    let completed = false;

    window.addEventListener('touchmove', (e) => {
        if (completed) return;
        e.preventDefault();
        
        const touch = e.touches[0];
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight * 0.55;
        
        // Position the ladle
        ladle.style.left = (touch.clientX - 30) + 'px';
        ladle.style.top = (touch.clientY - 30) + 'px';
        
        // Calculate the angle of rotation
        const dx = touch.clientX - centerX;
        const dy = touch.clientY - centerY;
        const angle = Math.atan2(dy, dx);
        
        if (lastAngle !== null) {
            let diff = angle - lastAngle;
            // Handle wrap-around
            if (diff > Math.PI) diff -= Math.PI * 2;
            if (diff < -Math.PI) diff += Math.PI * 2;
            
            totalRotation += Math.abs(diff);
            
            // Visual feedback
            const progress = Math.min((totalRotation / (Math.PI * 20)) * 100, 100);
            ring.style.borderColor = `hsl(${progress}, 100%, 50%)`;
            statMsg.innerText = `MASHING: ${Math.floor(progress)}%`;
            
            if (progress >= 100) {
                finishStage();
            }
        }
        lastAngle = angle;
    }, { passive: false });

    function finishStage() {
        completed = true;
        statMsg.innerText = "MICHELIN STAR MASH!";
        statMsg.style.color = "#39FF14";
        nextBtn.style.display = "block";
        // Simple haptic feedback for iPhone
        if (navigator.vibrate) navigator.vibrate(200);
    }
</script>
</body>
</html>
