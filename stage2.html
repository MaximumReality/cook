<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Harira Quest">
    <link rel="apple-touch-icon" href="mochkil-harira.PNG">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <title>The Mash | Snack Attack</title>
    <style>
    :root { 
        --neon-blue: #00FFEF; 
        --neon-pink: #FF00FF; 
        --neon-green: #39FF14; 
        --neon-cyan: #00FFFF;
    }

    body {
        margin: 0; padding: 0;
        background: url('cyber-kitchen-bg.PNG') no-repeat center center fixed;
        background-size: cover;
        height: 100vh; overflow: hidden; background-color: #000;
    }

    body::before {
        content: ""; position: fixed; inset: 0;
        background: rgba(0, 0, 0, 0.6); z-index: 0;
    }

    #ui-text { 
        position: absolute; top: 85px; left: 20px; 
        z-index: 100; pointer-events: none; font-family: 'Courier New', monospace;
    }

    .stat { color: var(--neon-blue); font-size: 20px; font-weight: bold; text-shadow: 2px 2px #000; }

    /* YOUR ORIGINAL WORKING POT STAGE */
    #game-container {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        width: 320px; /* Your original width */
        z-index: 10;
    }

    #bowl-img { width: 100%; height: auto; }

    #ladle-img {
        position: absolute;
        width: 140px; 
        z-index: 20;
        pointer-events: none;
        top: 20%; left: 50%;
        transform: translateX(-50%);
    }

    #azul-hud {
        position: absolute; top: 80px; right: 20px;
        width: 110px; border: 2px solid var(--neon-blue);
        background: rgba(0, 255, 239, 0.15); border-radius: 10px;
        text-align: center; font-size: 10px; z-index: 100;
        backdrop-filter: blur(5px);
    }

    #next-btn {
        display: none; position: absolute; bottom: 80px; left: 50%;
        transform: translateX(-50%); padding: 20px 40px;
        background: var(--neon-pink); border: none; color: white;
        font-weight: bold; border-radius: 50px; z-index: 200;
        box-shadow: 0 0 20px var(--neon-pink);
    }

    #landscape-blocker {
        display: none; position: fixed; inset: 0;
        background: #000; z-index: 9999; flex-direction: column;
        justify-content: center; align-items: center;
        font-family: 'Courier New', monospace; text-align: center;
    }

    @media screen and (orientation: portrait) {
        #landscape-blocker { display: flex; }
    }
    
    /* ... The rest of your hacker-box and animation styles stay the same ... */
</style>
</head>
<body>

<div id="landscape-blocker">
    <div class="hacker-box">
        <img src="mochkil-harira.png" alt="Mochkil" class="glitch-cat">
        <h2 class="neon-text">ROTATE YOUR DEVICE</h2>
        <div class="loading-bar"></div>
    </div>
</div>

<div id="ui-text"><div class="stat">DENSITY: <span id="density-val">0</span>%</div></div>

<div id="azul-hud">
    <img src="azul-insight.png" style="width: 80%; margin-top:5px;">
    <div id="azul-msg" style="color: var(--neon-blue); padding: 5px;">STIRRING...</div>
</div>

<div id="game-container">
    <img src="bowl-with-soup.png" id="bowl-img">
    <img src="ladle.png" id="ladle-img">
</div>

<button id="next-btn" onclick="window.location.href='stage3.html'">ADD THE SPICE</button>

<script>
    const music = new Audio('ready-to-play.mp3');
    music.loop = true;

    const ladle = document.getElementById('ladle-img');
    const container = document.getElementById('game-container');
    const densityVal = document.getElementById('density-val');
    const nextBtn = document.getElementById('next-btn');

    let totalRotation = 0;
    let lastAngle = null;
    let isDone = false;

    window.addEventListener('touchstart', () => { if(music.paused) music.play(); }, {once: true});

    window.addEventListener('touchmove', (e) => {
        if (isDone) return;
        e.preventDefault();
        
        const touch = e.touches[0];
        const rect = container.getBoundingClientRect();
        
        // Return to the offset math that worked for you
        const lx = touch.clientX - rect.left - 70; 
        const ly = touch.clientY - rect.top - 70;
        
        ladle.style.left = lx + 'px';
        ladle.style.top = ly + 'px';

        const dx = (lx + 70) - (rect.width / 2);
        const dy = (ly + 70) - (rect.height / 2);
        const angle = Math.atan2(dy, dx);
        
        if (lastAngle !== null) {
            let diff = angle - lastAngle;
            if (diff > Math.PI) diff -= Math.PI * 2;
            if (diff < -Math.PI) diff += Math.PI * 2;
            
            totalRotation += Math.abs(diff);
            const progress = Math.min((totalRotation / (Math.PI * 15)) * 100, 100);
            
            densityVal.innerText = Math.floor(progress);
            ladle.style.transform = `rotate(${angle + 1.5}rad)`; 

            if (progress >= 100) {
                isDone = true;
                nextBtn.style.display = "block";
                if(navigator.vibrate) navigator.vibrate(200);
            }
        }
        lastAngle = angle;
    }, { passive: false });
</script>
</body>
</html>
